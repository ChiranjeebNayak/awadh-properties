var listingMobileFilter={init:function(){$("em.toggleBadge,#dev_resetbtn,#selfClick").off("click");$("em.toggleBadge,#dev_resetbtn,#selfClick").on("click",function(){var cityid=queryParams.cityid;if($("#dev_city").attr("cityid")!=""){cityid=$("#dev_city").attr("cityid");}
let url=`/${type}/search?cityId=${cityid}`;if(page=="AZURO_LISTING")url=`/azuro/search?cityId=${cityid}`
window.location.href=url;});$('.smChips em').on('click',function(){$(this).closest('div').remove();if($('#chipUl div').hasClass('smChips')){$('#chipUl').css('display','')
$('#searchTextdserr').attr('placeholder','Add More')}else{$('#chipUl').css('display','none')
$('#searchTextdserr').attr('placeholder','Search using Location or Project Name')}})
if($('#chipUl div').hasClass('smChips')){$('#chipUl').css('display','')
$('#searchTextdserr').attr('placeholder','Add More')}
$('.changedLink').off('click');$('.changedLink ,.gblFilterHeaderHeading strong').on('click',function(){$('.gblHalfPopup.rrDSEfilterBy').addClass('active')})
$('.gblfilterByInnerBox .gblOverlay').on('click',function(){$('.gblHalfPopup.rrDSEfilterBy').removeClass('active')})
$('.gblSearchesInputIcoClear em.clear').on('click',function(){$('#searchTextdserr').val('');})
$(".filter_mobile").off("click");$(".filter_mobile").on("click",function(){var isselected=$(this).hasClass("selected");if(isselected==true){$(this).find("input[type='checkbox']").prop("checked",false);$(this).removeClass("selected");}else{$(this).find("input[type='checkbox']").prop("checked",true);$(this).addClass("selected");}});$("#unitCatType ul li input[type=radio][name=buildingType]").on('change',function(){let parentId=$(this).attr('filterunitcattype');$('#unitType').show();$('#unitType ul li').each(function(){if(parseInt($(this).data('parent'))===parseInt(parentId)){$(this).show()}else{$(this).hide()}
$(this).find('input[type=checkbox]').prop('checked',false);$(this).closest('li').removeClass('selected');});$('.gblMblFltrCrdUl.unitType').css("display","flex")});$('#unitType ul li').hide();if(queryParams.buildingType==1||queryParams.buildingType==2){$("input[filterunitcattype = '"+queryParams.buildingType+"']").attr("checked","checked");$('#unitType ul li[data-parent='+queryParams.buildingType+']').show();}else{$("#unitType ul li[data-parent='1']").show();}
$(document).on('click','#dev_mobile_selected_locations li span em.gblMblFltrCrdCls , #dev_mobile_location_filter li span em.gblMblFltrCrdCls',function(){let subLocalityId=$(this).attr('subLocalityId');mobileSelectedLocations.forEach((obj,index)=>{if(obj['subLocalityId']==subLocalityId){mobileSelectedLocations.splice(index,1);}});let selectedLocationElement=$(`ul.location-filter-ul li input[value=${subLocalityId}]`);selectedLocationElement.closest("li").removeClass('selected');selectedLocationElement.prop('checked',false);$(this).closest("li").remove();$(`li.filter_mobile input[value=${subLocalityId}]`).closest('li').removeAttr('style');});$(document).on('click','#dev_searchlabel,.gblFltrMblSrchBdgUlVsblValue',function(){$(".gblMblFltrPopup,body").addClass("active");});var searchTerm=' ';$("#searchtext").autocomplete({appendTo:$("#topresultsearch"),source:function(request,response){searchTerm=request.term;$.ajax({url:'/'+type+'/locationList',dataType:"json",data:{cityId:cityId,q:request.term,ltype:(type=="resale")?"sale":"rent",excludes:(queryParams.locationId)?queryParams.locationId.split(','):[],excludep:(queryParams.projectId)?queryParams.projectId.split(','):[]},type:"POST",success:function(data){response(data);}});},autoFocus:true,focus:function(event,ui){$("#topresultsearch ul").removeAttr("style");},minLength:2,select:function(event,ui){if(_galaktic_search){let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
let eventName={"keyword":searchTerm,"suggest":ui.item.suggestion,"type":type.toLowerCase()=='resale'?'Resale':'Rental',"city":cityId,"redirectUrl":ui.item.redirect_url,'pageType':dLayer_pagetype};_paq.push(['trackSiteSearch',JSON.stringify(eventName)]);eventName={"redirectUrl":ui.item.redirect_url,"type":type=='resale'?'Resale':'Rental',"pageType":dLayer_pagetype};setTimeout(()=>{_paq.push(['trackEvent','filter','apply',JSON.stringify(eventName)]);},100);window.location.href=ui.item.redirect_url;return false;}
$('#loaderBox').show();if(queryParams.locationId&&ui.item.type=='locality'){queryParams.locationId=queryParams.locationId+","+ui.item.subLocalityId;applyFilterByQueryparams();}else if(ui.item.type=='locality'){queryParams.locationId=ui.item.subLocalityId;applyFilterByQueryparams();}else if(queryParams.projectId&&ui.item.type=='project'){queryParams.projectId=queryParams.projectId+","+ui.item.beatsProjectId;applyFilterByQueryparams();}else if(ui.item.type=='project'){queryParams.projectId=ui.item.beatsProjectId;applyFilterByQueryparams();}}}).autocomplete("instance")._renderItem=function(ul,item){const ListingCls=(type=="resale")?"DSE_Resale_D2":"DSE_Rental_D2";if(_galaktic_search){var label=item.label!=null?item.label:'';var lihtml=`<em class="icon-search ${ListingCls}"></em>`+item.suggestion+`<span class='${ListingCls}'>`+label+'</span>';}else{let name=item.type=='locality'?item.subLocalityName+', '+item.cityName:item.type=='project'?item.projectName+', '+item.cityName:'';var lihtml=`<em class="icon-search ${ListingCls}"></em>`+name+`<span class='${ListingCls}'>`+item.type+'</span>';}
return $(`<li class='${ListingCls}'>`).append(lihtml).appendTo(ul);};$('body').on('focus','#searchTextdserr',function(){let $this=$(this);var searchTerm='';var cityIdG=cityId;$.getScript("/assets/lib/js/jquery-ui.js",function(){$this.autocomplete({appendTo:$("#searchKeyWordDropDown"),source:function(request,response){searchTerm=request.term;activeTab=type;let reqData={'ltype':(type=='resale'?'sale':'rent'),"q":request.term,"type":"locality","cityId":cityId,}
$.ajax({url:baseUrl+type+'/locationList',dataType:"json",data:reqData,type:"POST",success:function(data){reqData={};var addedloc=$('#chipUl .smChips').data('sublocality_id');if(addedloc&&$('#chipUl .smChips').data('category')=='locality'){data=data.filter(function(e){if(e.subLocalityId!=addedloc&&e.type!='project'){return e}})}else if(addedloc&&$('#chipUl .smChips').data('category')=='project'){data=data.filter(function(e){if(e.subLocalityId!=addedloc&&e.type!='locality'){return e}})}
response(data);}});},autoFocus:true,focus:function(event,ui){$("#searchKeyWordDropDown").show();$("#searchKeyWordDropDown div").removeAttr("style");},minLength:2,select:function(event,ui){let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
if(_galaktic_search==true){let eventName={"keyword":searchTerm,"suggest":ui.item.suggestion,"type":activeTab=='resale'?'Resale':'Rental',"city":cityIdG,"redirectUrl":ui.item.redirect_url,"pageType":dLayer_pagetype};_paq.push(['trackSiteSearch',JSON.stringify(eventName)]);eventName={"redirectUrl":ui.item.redirect_url,"type":activeTab=='resale'?'Resale':'Rental',"pageType":dLayer_pagetype};setTimeout(()=>{_paq.push(['trackEvent','filter','apply',JSON.stringify(eventName)]);},100);newMobileSearchProp.goToURL(ui.item.redirect_url);return false;}
var text='';if(ui.item.projectName!=undefined&&ui.item.projectName.length>=2){text=ui.item.projectName+', '+ui.item.subLocalityName+', '+ui.item.cityName;}else if(ui.item.subLocalityName!=undefined&&ui.item.subLocalityName.length>=2){text=ui.item.subLocalityName+', '+ui.item.cityName;}else if(ui.item.subLocalityName==undefined){text=ui.item.cityName;}
chip=$('<div/>',{class:"smChips",'data-city_id':ui.item.cityId,'data-sublocality_id':ui.item.subLocalityId,'data-project_id':ui.item.dotcomProjectId,'data-category':ui.item.type,text:text}).append($('<em/>',{class:"icon-close"}).on('click',function(e){e.preventDefault();e.stopPropagation();$(this).closest('.smChips').remove();if($('#chipUl div').hasClass('smChips')){$('#searchTextdserr').attr('placeholder','Add More')
$('#chipUl').css('display','')}else{$('#searchTextdserr').attr('placeholder','Search by Location, Project Name')
$('#chipUl').css('display','none')}}));$('#chipUl').append(chip);if($('#chipUl div').hasClass('smChips')){$('#searchTextdserr').attr('placeholder','Add More')
$('#chipUl').css('display','')}
let suggestion,redirect_url;let tab=activeTab=='Resale'?'resale':'rental'
if(ui.item.type=='locality'){suggestion=ui.item.subLocalityName+', '+ui.item.cityName;redirect_url=window.location.origin+'/'+tab+'/search?cityId='+ui.item.cityId+'&&'+'locationId='+ui.item.subLocalityId}else{suggestion=ui.item.projectName+' '+ui.item.subLocalityName+' '+ui.item.cityName;redirect_url=window.location.origin+'/'+tab+'/search?cityId='+ui.item.cityId+'&&'+'dotcomprojectid='+ui.item.dotcomProjectId}
let eventName={"keyword":searchTerm,"suggest":suggestion,"type":activeTab=='Resale'?'Resale':'Rental',"city":cityIdG,"redirectUrl":redirect_url,"pageType":dLayer_pagetype};_paq.push(['trackSiteSearch',JSON.stringify(eventName)]);$(this).val('');return false;},}).autocomplete("instance")._renderItem=function(div,item){var lihtml='';var ctaClass=(activeTab=='resale'?'Home_Search_L19':'Home_Search_L20')
if(_galaktic_search==true){var label=item.label!=null?item.label:'';lihtml=`<em class="icon-search ${ctaClass}"></em>${item.suggestion}<span class="${ctaClass}">${label}</span>`;}else{if(item.projectName!=undefined&&item.projectName.length>=2&&$('#chipUl div.smChips').data('project_id')!=item.dotcomProjectId){lihtml=`<div class="searchValueName"><div class="searchAbsBox"><em class="searchIcoGray"></em></div><span>${item.projectName}, ${item.subLocalityName}, ${item.cityName}</span></div>`;lihtml=lihtml+`<div class="searchRelated">${item.type.toUpperCase()}</div>`;return $('<div class="gblSearchAutoCompleteLi">').append(lihtml).appendTo(div);}else if(item.subLocalityName!=undefined&&item.subLocalityName.length>=2&&$('#chipUl div.smChips').data('sublocality_id')!=item.subLocalityId){lihtml=`<div class="searchValueName"><div class="searchAbsBox"><em class="searchIcoGray"></em></div><span>${item.subLocalityName}, ${item.cityName}</span></div>`;lihtml=lihtml+`<div class="searchRelated">${item.type.toUpperCase()}</div>`;return $('<div class="gblSearchAutoCompleteLi">').append(lihtml).appendTo(div);}else if(item.subLocalityName==undefined){lihtml=`<div class="searchValueName"><div class="searchAbsBox"><em class="searchIcoGray"></em></div><span>${item.cityName}</span></div>`;lihtml=lihtml+`<div class="searchRelated">${item.type.toUpperCase()}</div>`;return $('<div class="gblSearchAutoCompleteLi">').append(lihtml).appendTo(div);}}};});});if(queryParams.bedrooms){let bhkSelected=queryParams.bedrooms.split(',');$.each(bhkSelected,function(i,size){$(`input[name=bedroom][value='${size}']`).attr("checked","checked");$(`input[name=bedroom][value='${size}']`).closest("li.filter_mobile").addClass("selected");});}
if(queryParams.postedBy){let selectedPostedBy=queryParams.postedBy.split(',');$.each(selectedPostedBy,function(i,pb){pb=pb.toString();$(`input[name=postedBy][value='${pb}']`).attr("checked","checked");$(`input[name=postedBy][value='${pb}']`).closest("li.filter_mobile").addClass("selected");});}
if(queryParams.buildingType){let buildingTypeSelected=queryParams.buildingType;let selectedBuildingTypeElement=$(`input[name='buildingType'][value=${buildingTypeSelected}]`);}
if(queryParams.propertyType){}
if(queryParams.furnishing){let selectedFurnishing=queryParams.furnishing.split(',');$.each(selectedFurnishing,function(i,furnish){furnish=furnish.trim();$(`input[name=furnishing][value='${furnish}']`).attr("checked","checked");$(`input[name=furnishing][value='${furnish}']`).closest("li.filter_mobile").addClass("selected");});}
if(budgetQueryFilter){let minPriceSelected=budgetQueryFilter.minPrice;let maxPriceSelected=budgetQueryFilter.maxPrice;$(`#dev_mobile_min_budget option[value="${minPriceSelected}"]`).prop('selected',true);if(maxPriceSelected){$(`#dev_mobile_max_budget option[value="${maxPriceSelected}"]`).prop('selected',true);}}
if(queryParams.minArea&&queryParams.maxArea){let minAreaSelected=queryParams.minArea;let maxAreaSelected=queryParams.maxArea;$(`#dev_mobile_min_area option[value="${minAreaSelected}"]`).prop('selected',true);$(`#dev_mobile_max_area option[value="${maxAreaSelected}"]`).prop('selected',true);}
const applyFilterByQueryparams=()=>{if(Object.values(queryParams).length){url=url+"?"+Object.keys(queryParams).map(key=>(queryParams[key])?key+'='+encodeURIComponent(queryParams[key]):'').join('&');}
location.href=url;};$("button.gblMblFltrBtn ").off("click");$('button.gblMblFltrBtn').on('click',function(){let url=listingMobileFilter.getMobileFilters();let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
let eventName={"redirectUrl":url,"type":type=='resale'?'Resale':'Rental','pageType':dLayer_pagetype};_paq.push(['trackEvent','filter','apply',JSON.stringify(eventName)]);window.location.href=url;});},getMobileFilters:function(){var cityid=$("#dev_city").attr("cityid");let url=`/${type}/search?cityId=${cityid}`;if(page=="AZURO_LISTING")url=`/azuro/search?cityId=${cityid}`;const q=$('#searchtext').val()||'';let bedrooms=[];let locationId=[];let furnishing=[];let unitTypeId=[];let postedBy=[];let propertyTypeId;let projectId=[];$('.searchKeyWordUl .smChips').each(function(){if($(this).data('category')=='project'){var projid=$(this).data('project_id');if(projectId.length==0){projectId.push(projid)}else{if(projectId.find(e=>e!=projid)){projectId.push(projid)}}}});if(projectId.length){url=url+'&dotcomprojectid='+encodeURIComponent(projectId.join(','));}
$.each($("input[name='bedroom']:checked"),function(){bedrooms.push($(this).val());});if(q.trim()){url=url+'&q='+q.trim();}
if(bedrooms.length){url=url+'&bedrooms='+encodeURIComponent(bedrooms.join(','));}
$.each($("input[name='postedBy']:checked"),function(){postedBy.push($(this).val());});if(postedBy.length){url=url+'&postedBy='+encodeURIComponent(postedBy.join(','));}
$.each($("input[name='buildingType']:checked"),function(){propertyTypeId=$(this).val();});if(propertyTypeId){url=url+'&buildingType='+propertyTypeId;}
$.each($("input[name='furnishing']:checked"),function(){furnishing.push($(this).val());});if(furnishing.length){url=url+'&furnishing='+encodeURIComponent(furnishing.join(','));}
var minval=$("#dev_mobile_min_budget").val();var maxval=$("#dev_mobile_max_budget").val();if(minval!=undefined&&minval!=""&&maxval!=""&&maxval!=undefined){url=url+"&minPrice="+encodeURIComponent(minval)+"&maxPrice="+encodeURIComponent(maxval);}
if(minval!=undefined&&minval!=""&&(maxval==undefined||maxval=="")){url=url+"&minPrice="+encodeURIComponent(minval);}
var minAreaVal=$("#dev_mobile_min_area").val();var maxAreaVal=$("#dev_mobile_max_area").val();if(minAreaVal!=undefined&&minAreaVal!=""&&maxAreaVal!=""&&maxAreaVal!=undefined){url=url+"&minArea="+encodeURIComponent(minAreaVal)+"&maxArea="+encodeURIComponent(maxAreaVal);}
$.each($("input[name='location']:checked"),function(){locationId.push($(this).val());});$('.searchKeyWordUl .smChips').each(function(){if($(this).data('category')=='locality'){var locid=$(this).data('sublocality_id');if(locationId.length==0){locationId.push(locid)}else{if(locationId.find(e=>e!=locid)){locationId.push(locid)}}}});if(locationId.length){url=url+'&locationId='+encodeURIComponent(locationId.join(','));}
$.each($("input[name='unittype']:checked"),function(){unitTypeId.push($(this).val());});if(unitTypeId.length){url=url+'&propertyType='+encodeURIComponent(unitTypeId.join(','));}
return url;},selectLocation:function(subLocalityId,subLocalityName){let alreadyExist=false;mobileSelectedLocations.forEach(selectedLocation=>{if(selectedLocation.subLocalityId==subLocalityId&&selectedLocation.subLocalityName==subLocalityName){alreadyExist=true;}});if(!alreadyExist){mobileSelectedLocations.push({subLocalityId:subLocalityId,subLocalityName:subLocalityName});$(`li.filter_mobile input[value=${subLocalityId}]`).closest('li').css('display','flex');$(`li.filter_mobile input[value=${subLocalityId}]`).closest('li').attr('data-showVal','0');}
let mobileSelectedLcationhtml='';mobileSelectedLocations.forEach(selectedLcation=>{mobileSelectedLcationhtml=mobileSelectedLcationhtml+`<li class="gblMblFltrCrdLi selected"><input type="checkbox" name="selectedLocation" value="${selectedLcation.subLocalityId}" class="optionInput" style="display: none;"><span class="gblMblFltrCrdChp">${selectedLcation.subLocalityName} <em class="icon-close gblMblFltrCrdCls" subLocalityId="${selectedLcation.subLocalityId}"></em></span></li>`;});$('#dev_mobile_selected_locations').html(mobileSelectedLcationhtml);$(".gblMblFltrSrchBx").toggleClass("active");}};