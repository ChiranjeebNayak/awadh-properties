var listingfunction={init:function(){let postedBy=[];$(".fullStackServicesBox .fSSPannelHeader").off("click")
$(".fullStackServicesBox .fSSPannelHeader").on("click",function(){if($(this).parent(".fSSPannel").hasClass("active")){$(this).parent(".fSSPannel").removeClass("active");}else{$('.fullStackServicesBox .fSSPannel').removeClass('active');$(this).parents('.fSSPannel').addClass('active');}});let endtime,timeinterval;var min_values=$(".rangeVluBxMnBx ul.rangeVluBxUl.budget li.rangeVluBxli");var max_values=$(".rangeVluBxMxBx ul.rangeVluBxUl.budget li.rangeVluBxli");var min_area_values=$(".rangeVluBxMnBx ul.rangeVluBxUl.area li.rangeVluBxli");var max_area_values=$(".rangeVluBxMxBx ul.rangeVluBxUl.area li.rangeVluBxli");var min_input=$('.drpdwnMenu .gblFltrCntntBx div.rangeInptBx .minBox input.min_price');var max_input=$('.drpdwnMenu .gblFltrCntntBx div.rangeInptBx .maxBox input.max_price');var min_area_input=$(".drpdwnMenu .gblFltrCntntBx .minBox input.min_input");var max_area_input=$(".drpdwnMenu .gblFltrCntntBx .maxBox input.max_input");min_values.click(function(){var minValue=$(this).attr('value');var minValueText=$(this).attr('text');min_input.val(minValueText);min_input.attr("minval",minValue);disableDropDownRangeOptions(max_values,minValue);validateDropDownInputs();if($("#min_price").val()!=""||$("#max_price").val()!=""){$(".filterbudget_applybtn").removeAttr("style");}else{$(".filterbudget_applybtn").attr("display","none");}
$('#minBox').hide();$('#maxBox').show();});min_area_values.click(function(){var minValue=$(this).attr('value');var minValueText=$(this).attr('text');min_area_input.val(minValueText);min_area_input.attr("minval",minValue);disableDropDownRangeOptions(max_area_values,minValue);validateDropDownInputs();if($("#min_area").val()!=""&&$("#max_area").val()!=""){$(this).closest('div.drpdwnMenu').find('div.gblFltrBtnBx').removeAttr("style");}else{$(this).closest('div.drpdwnMenu').find('div.gblFltrBtnBx').attr("display","none");}});max_values.click(function(){var maxValue=$(this).attr('value');var maxValueText=$(this).attr('text');max_input.val(maxValueText);max_input.attr("maxval",maxValue);disableDropDownRangeOptionsForMin(min_values,maxValue);validateDropDownInputs();if($("#min_price").val()!=""||$("#max_price").val()!=""){$(".filterbudget_applybtn").removeAttr("style");}else{$(".filterbudget_applybtn").attr("display","none");}
$('#minBox').show();$('#maxBox').hide();applyFilter();});max_area_values.on('click',function(){var maxValue=$(this).attr('value');var maxValueText=$(this).attr('text');max_area_input.val(maxValueText);max_area_input.attr("maxval",maxValue);disableDropDownRangeOptionsForMin(min_area_values,maxValue);validateDropDownInputs();if($("#min_area").val()!=""&&$("#max_area").val()!=""){$(this).closest('div.drpdwnMenu').find('div.gblFltrBtnBx').removeAttr("style");}else{$(this).closest('div.drpdwnMenu').find('div.gblFltrBtnBx').attr("display","none");}
applyFilter()});min_input.on('input',function(){var minValue=min_input.val();disableDropDownRangeOptions(max_values,minValue);validateDropDownInputs();if($("#min_price").val()!=""&&$("#max_price").val()!=""){$(".filterbudget_applybtn").removeAttr("style");}else{$(".filterbudget_applybtn").attr("display","none");}});min_area_input.on('input',function(){var minValue=min_area_input.val();disableDropDownRangeOptions(min_area_values,minValue);validateDropDownInputs();if($("#min_area").val()!=""&&$("#max_area").val()!=""){$(".filterarea_applybtn").removeAttr("style");}else{$(".filterarea_applybtn").attr("display","none");}});max_input.on('input',function(){var maxValue=max_input.val();disableDropDownRangeOptionsForMin(min_values,maxValue);if($("#min_price").val()!=""&&$("#max_price").val()!=""){$(".filterbudget_applybtn").removeAttr("style");}else{$(".filterbudget_applybtn").attr("display","none");}
validateDropDownInputs();});max_area_input.on('input',function(){var maxValue=max_area_input.val();disableDropDownRangeOptionsForMin(max_area_values,maxValue);if($("#min_area").val()!=""&&$("#max_area").val()!=""){$(".filterarea_applybtn").removeAttr("style");}else{$(".filterarea_applybtn").attr("display","none");}
validateDropDownInputs();});function disableDropDownRangeOptions(max_values,minValue){if(max_values){max_values.each(function(){var maxValue=$(this).attr("value");if(maxValue!=0){if(parseInt(maxValue)<=parseInt(minValue)){$(this).hide();}else{$(this).show();}}});}}
function disableDropDownRangeOptionsForMin(min_values,maxValue){if(min_values){min_values.each(function(){var minValue=$(this).attr("value");if(minValue!=0){if(parseInt(minValue)>=parseInt(maxValue)){$(this).hide();}else{$(this).show();}}});}}
const validateDropDownInputs=()=>{var minValue=parseInt(min_input.val());var maxValue=parseInt(max_input.val());if(maxValue>0&&minValue>0&&maxValue<minValue){min_input.addClass('inputError');max_input.addClass('inputError');return false;}else{min_input.removeClass('inputError');max_input.removeClass('inputError');return true;}}
const applyFilterCommon=()=>{queryParams.page=1;queryParams.q=$('#searchtext').val()||'';let bedrooms=[];let locationId=[];let postedBy=[];$.each($("input[name='bedroom']:checked"),function(){bedrooms.push($(this).val());});$.each($("input[name='locality']:checked"),function(){locationId.push($(this).val());});$.each($("input[name='postedBy']:checked"),function(){postedBy.push($(this).val());});queryParams.locationId=locationId.join(',');queryParams.bedrooms=bedrooms.join(',');queryParams.postedBy=postedBy.join(',');if(!globalIsMobileBrowser){queryParams.minPrice=$('input[name=min_price]').val();queryParams.maxPrice=$('input[name=max_price]').val();}
queryParams.maxArea=$('input[name=max_area]').val();let furnishing=[];$.each($("input[name='furnishing']:checked"),function(){furnishing.push($(this).val());});queryParams.furnishing=furnishing.join(',');queryParams.buildingType=$('input[name=buildingType]:checked').val();let propertyType=[];$.each($("li[data-parent="+queryParams.buildingType+"] input[name='propertyType']:checked"),function(){propertyType.push($(this).val());});queryParams.propertyType=propertyType.join(',');let listingTypeVal=$('ul.sqyFltrTgUl li.sqyFltrTgLi.active').val();if(listingTypeVal)queryParams.listingType=listingTypeVal;Object.keys(queryParams).forEach((key)=>(!queryParams[key])&&delete queryParams[key]);getFilteredPage();}
if(queryParams.buildingType==1){$('ul.unitType').css("display","block");$('ul.unitType li').hide();$('ul.unitType li[data-parent='+1+']').show();}else if(queryParams.buildingType==2){$('ul.unitType').css("display","block");$('ul.unitType li').hide();$('ul.unitType li[data-parent='+2+']').show();}else{$('ul.unitType').css("display","block");$('ul.unitType li').hide();$('ul.unitType li[data-parent='+1+']').show();}
const applyFilter=()=>{queryParams.page=1;queryParams.q=$('#searchtext').val()||'';let bedrooms=[];let locationId=[];let project=[];let locNamesArr=[];$.each($("input[name='bedroom']:checked"),function(){bedrooms.push($(this).val());});$.each($("input[name='project']:checked"),function(){project.push($(this).val());});$.each($("input[name='locality']:checked"),function(){locationId.push($(this).val());locNamesArr.push($(this).attr("zonename"));});if(globalIsMobileBrowser){$('.searchKeyWordUl .smChips').each(function(){if($(this).data('category')=='locality'){var locid=$(this).data('sublocality_id');if(locationId.length==0){locationId.push(locid)}else{if(locationId.find(e=>e!=locid)){locationId.push(locid)}}}});$.each($("input[name='location']:checked"),function(){locationId.push($(this).val());});$('.searchKeyWordUl .smChips').each(function(){if($(this).data('category')=='project'){var projid=$(this).data('project_id');if(project.length==0){project.push(projid)}else{if(project.find(e=>e!=projid)){project.push(projid)}}}});var minval=$("#dev_mobile_min_budget").val();var maxval=$("#dev_mobile_max_budget").val();if(minval!=undefined&&minval!=""&&(maxval==undefined||maxval=="")){queryParams.minPrice=minval}
if(minval!=undefined&&minval!=""&&maxval!=""&&maxval!=undefined){queryParams.minPrice=minval
queryParams.maxPrice=maxval}
var minAreaVal=$("#dev_mobile_min_area").val();var maxAreaVal=$("#dev_mobile_max_area").val();if(minAreaVal!=undefined&&minAreaVal!=""&&maxAreaVal!=""&&maxAreaVal!=undefined){queryParams.minArea=minAreaVal
queryParams.maxArea=maxAreaVal}}
$.each($("input[name='postedBy']:checked"),function(){postedBy.push($(this).val());});queryParams.dotcomprojectid=project.join(',');queryParams.locationId=locationId.join(',');queryParams.bedrooms=bedrooms.join(',');queryParams.postedBy=postedBy.join(',');if(!globalIsMobileBrowser){queryParams.minPrice=$('input[name=min_price]').attr("minval");queryParams.maxPrice=$('input[name=max_price]').attr("maxval");queryParams.minArea=$('input[name=min_area]').attr("minval");queryParams.maxArea=$('input[name=max_area]').attr("maxval");}
let furnishing=[];$.each($("input[name='furnishing']:checked"),function(){furnishing.push($(this).val());});queryParams.furnishing=furnishing.join(',');queryParams.buildingType=$('input[name=buildingType]:checked').val();let propertyType=[];if(queryParams.buildingType){$.each($("li[data-parent="+queryParams.buildingType+"] input[name='propertyType']:checked"),function(){propertyType.push($(this).val());});}else{if($("li[data-parent="+1+"] input[name='propertyType']:checked")){$.each($("li[data-parent="+1+"] input[name='propertyType']:checked"),function(){if(propertyType.length==0){propertyType.push($(this).val());}else{if(propertyType.find(e=>e!=$(this).val())){propertyType.push($(this).val())}}});}else if($("li[data-parent="+2+"] input[name='propertyType']:checked")){$.each($("li[data-parent="+2+"] input[name='propertyType']:checked"),function(){if(propertyType.length==0){propertyType.push($(this).val());}else{if(propertyType.find(e=>e!=$(this).val())){propertyType.push($(this).val())}}});}}
if((queryParams.postedBy||queryParams.image360||queryParams.isVerified)&&queryParams.buildingType==undefined){queryParams.propertyType=queryParams.propertyType?queryParams.propertyType:[]}else{queryParams.propertyType=propertyType.join(',');}
let listingTypeVal=$('ul.sqyFltrTgUl li.sqyFltrTgLi.active').val();if(listingTypeVal)queryParams.listingType=listingTypeVal;queryParams.dotcomprojectid!=''?$('.project .drpdwnTgl').addClass('gblFltrSlctdVlue'):$('.project .drpdwnTgl').removeClass('gblFltrSlctdVlue');if(queryParams.locationId!=''){$('.location .drpdwnTgl').addClass('gblFltrSlctdVlue');}else{$('.location .drpdwnTgl').removeClass('gblFltrSlctdVlue');}
if(queryParams.bedrooms!=''){$('.bedrooms .drpdwnTgl').addClass('gblFltrSlctdVlue');}else{$('.bedrooms .drpdwnTgl').removeClass('gblFltrSlctdVlue');}
if(queryParams.furnishing!=''||queryParams.maxArea>0){$('.more .drpdwnTgl').addClass('gblFltrSlctdVlue');}else{$('.more .drpdwnTgl').removeClass('gblFltrSlctdVlue');}
if(queryParams.postedBy!=''){$('.postedBy .drpdwnTgl').addClass('gblFltrSlctdVlue');}else{$('.postedBy .drpdwnTgl').removeClass('gblFltrSlctdVlue');}
if(queryParams.propertyType!=''){$('.property .drpdwnTgl').addClass('gblFltrSlctdVlue');}else{$('.property .drpdwnTgl').removeClass('gblFltrSlctdVlue');}
if(queryParams.maxPrice>0){$('.budget .drpdwnTgl').addClass('gblFltrSlctdVlue');}else{$('.budget .drpdwnTgl').removeClass('gblFltrSlctdVlue');}
if(queryParams.sort_key){listingfunction.displaySortKey()}
Object.keys(queryParams).forEach((key)=>(!queryParams[key])&&delete queryParams[key]);listingfunction.loadMoreAjax({params:queryParams,locNamesArr:locNamesArr});}
$('input[name=bedroom], input[name=locality], input[name=furnishing], input[name=buildingType], input[name=propertyType], input[name=listingType]').on('click',function(){$(this).closest('div.drpdwnMenu').find('div.gblFltrBtnBx').show();});$('ul.buildingType li input[type=radio]').off('change')
$('ul.buildingType li input[type=radio]').on('change',function(){var selectedBuilding=$(this).val();$('.gblFltrChckBxStrng').show();$('ul.unitType').css("display","block");$('ul.unitType li').hide();$('ul.unitType li[data-parent='+selectedBuilding+']').show();$('ul.unitType li').each(function(){var label=$(this).find('label');var checkbox=$(this).find('input');var span=$(this).find('span');if(selectedBuilding=='1'){$(this).addClass(`DSE_${type}_D29`).removeClass(`DSE_${type}_D30`);label.addClass(`DSE_${type}_D29`).removeClass(`DSE_${type}_D30`);checkbox.addClass(`DSE_${type}_D29`).removeClass(`DSE_${type}_D30`);span.addClass(`DSE_${type}_D29`).removeClass(`DSE_${type}_D30`);}
else{$(this).addClass(`DSE_${type}_D30`).removeClass(`DSE_${type}_D29`);label.addClass(`DSE_${type}_D30`).removeClass(`DSE_${type}_D29`);checkbox.addClass(`DSE_${type}_D30`).removeClass(`DSE_${type}_D29`);span.addClass(`DSE_${type}_D30`).removeClass(`DSE_${type}_D29`);}})
queryParams.buildingType=selectedBuilding;applyFilter();});$('#searchtext').on("keyup",function(event){if(event.keyCode===13){event.preventDefault();$('#loaderBox').show();applyFilterCommon();}});$(".gblFltr ul.checkBox li input[type='checkbox']").off("click")
$(".gblFltr ul.checkBox li input[type='checkbox']").on("click",function(){applyFilter();});$('.gblFltrSrchBxInptEm , .gblFltrMblSrchBxInptEm').on('click',function(){$('#loaderBox').show();applyFilterCommon();});$("#searchtext").autocomplete({appendTo:$("#topresultsearch"),source:function(request,response){$.ajax({url:'/'+type+'/locationList',dataType:"json",data:{cityId:cityId,q:request.term,ltype:(type=="resale")?"sale":"rent",excludes:(queryParams.locationId)?queryParams.locationId.split(','):[],excludep:(queryParams.projectId)?queryParams.projectId.split(','):[]},type:"POST",success:function(data){response(data);}});},autoFocus:true,focus:function(event,ui){$("#topresultsearch ul").removeAttr("style");},minLength:2,select:function(event,ui){if(_galaktic_search){let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
let eventName={"keyword":searchTerm,"suggest":ui.item.suggestion,"type":type=='resale'?'Resale':'Rental',"city":cityIdG,"redirectUrl":ui.item.redirect_url,"pageType":dLayer_pagetype};_paq.push(['trackSiteSearch',JSON.stringify(eventName)]);eventName={"redirectUrl":ui.item.redirect_url,"type":type=='resale'?'Resale':'Rental',"pageType":dLayer_pagetype};setTimeout(()=>{_paq.push(['trackEvent','filter','apply',JSON.stringify(eventName)]);},100);window.location.href=ui.item.redirect_url;return false;}
$('#loaderBox').show();if(queryParams.locationId&&ui.item.type=='locality'){queryParams.locationId=queryParams.locationId+","+ui.item.subLocalityId;applyFilterCommon();}else if(ui.item.type=='locality'){queryParams.locationId=ui.item.subLocalityId;applyFilterCommon();}else if(queryParams.projectId&&ui.item.type=='project'){queryParams.projectId=queryParams.projectId+","+ui.item.beatsProjectId;applyFilterCommon();}else if(ui.item.type=='project'){queryParams.projectId=ui.item.beatsProjectId;applyFilterCommon();}}}).autocomplete("instance")._renderItem=function(ul,item){if(_galaktic_search){var label=item.label!=null?item.label:'';var lihtml='<em class="icon-search"></em>'+item.suggestion+'<span>'+label+'</span>';}else{let name=item.type=='locality'?item.subLocalityName+', '+item.cityName:item.type=='project'?item.projectName+', '+item.cityName:'';var lihtml='<em class="icon-search"></em>'+name+'<span>'+item.type+'</span>';}
return $("<li>").append(lihtml).appendTo(ul);};$('#location-filter').keyup(function(){var searchText=$(this).val();$('.location-filter-ul > li').each(function(){if($(this).attr('data-showVal')!='0')
{var currentLiText=$(this).text().toLowerCase();var showCurrentLi=currentLiText.indexOf(searchText.toLowerCase())!==-1;$(this).toggle(showCurrentLi);}});});$('#project-filter').keyup(function(){var searchText=$(this).val();$('.project-filter-ul > li').each(function(){if($(this).attr('data-showVal')!='0')
{var currentLiText=$(this).text().toLowerCase();var showCurrentLi=currentLiText.indexOf(searchText.toLowerCase())!==-1;$(this).toggle(showCurrentLi);}});});$(document).on("click","#changeNumber",function(){$('.otpError').html('');$("input[name=otp_contactform").val('');$('.ldBx.ldOtpBx').hide();$(".ldBx.changeNumber").show();});$(document).off('click','.squarePlusFilter ul li.360Tour');$(document).on('click','.squarePlusFilter ul li.360Tour',function(e){e.preventDefault();queryParams.image360=queryParams.image360?'':1
queryParams.isVerified=''
if(queryParams.postedBy!=undefined&&queryParams.postedBy.length){delete queryParams.postedBy;$('.postedBy ul li#1 input[name="postedBy"]').attr('checked',false)}
applyFilter()});$(document).off('click','.squarePlusFilter ul li.Verified');$(document).on('click','.squarePlusFilter ul li.Verified',function(e){e.preventDefault();queryParams.isVerified=queryParams.isVerified?'':1
queryParams.image360='';if(queryParams.postedBy!=undefined&&queryParams.postedBy.length){delete queryParams.postedBy;$('.postedBy ul li#1 input[name="postedBy"]').attr('checked',false)}
applyFilter()});$(document).off('click','.squarePlusFilter ul li.Owner');$(document).on('click','.squarePlusFilter ul li.Owner',function(e){e.preventDefault();queryParams.isVerified=''
queryParams.image360=''
if(queryParams.postedBy){$('.postedBy ul li#1 input[name="postedBy"]').attr('checked',false)}else{$('.postedBy ul li#1 input[name="postedBy"]').attr('checked','checked')}
if(globalIsMobileBrowser){$('.postedBy ul li#1 input[name="postedBy"]').closest("li.filter_mobile").addClass("selected");}
applyFilter()});$(document).on("submit","#listingContactAgentForm",function(e){e.preventDefault()
if(type.toLowerCase()=='resale'){if(e.target.userTypeId.value.toLowerCase()=='owner'){$('#confirmOtp').addClass('DSE_Resale_L4').removeClass("DSE_Resale_L3");}else{$('#confirmOtp').addClass('DSE_Resale_L2').removeClass("DSE_Resale_L1");}}else{if(e.target.userTypeId.value.toLowerCase()=='owner'){$('#confirmOtp').addClass('DSE_Rental_L4').removeClass("DSE_Rental_L3");}else{$('#confirmOtp').addClass('DSE_Rental_L2').removeClass("DSE_Rental_L1");}};sendOtp('listingContactAgentForm');});$(document).on("submit","#ListingChatForm",function(e){e.preventDefault();if(type.toLowerCase()=='resale'){if(e.target.chatformUserTypeId.defaultValue.toLowerCase()=='owner'){$("#confirmOtp").addClass("DSE_Resale_L3").removeClass("DSE_Resale_L4");}else{$("#confirmOtp").addClass("DSE_Resale_L1").removeClass("DSE_Resale_L2");}}else{if(e.target.chatformUserTypeId.defaultValue.toLowerCase()=='owner'){$("#confirmOtp").addClass("DSE_Rental_L3").removeClass("DSE_Rental_L4");}else{$("#confirmOtp").addClass("DSE_Rental_L1").removeClass("DSE_Rental_L2");}}
sendOtp('ListingChatForm');});const sendOtp=(formid)=>{$('#loaderBox').show();$("#"+formid).find("#dev_errormsg").text("");$("#"+formid).find("#dev_errormsg").css("display","none");$('.otpError').html('');let data=$('#'+formid).serializeArray();let filteredData={}
data.filter(v=>{filteredData[v.name]=v.value;});$.ajax({type:"POST",url:'/'+type+'/send-broker-detail-otp',data:filteredData,success:function(data){if(data.status){if(data.otp){var otp=data.otp.toString();$("input[name=otp_contactform").val(otp);}
$("#formid").attr("value",formid);$('#otpMobile').html('+'+filteredData.countryCode+'-'+filteredData.mobile);$(".gblPpup.leadForm").addClass("active");$('#whatsapp-check').val($('.gblPpup.leadForm .ldChk input[name=agent_whatsapp_check1]:checked').length?true:false)
$('#listingContactAgentForm').hide();$('#popupOtpForm').show();$('#agentNumberChange').hide();if(formid=="ListingChatForm"){$(".gblPpup.whtsAp").removeClass("active");}
run_clock('countDownTimer',15,true,'Expired');$('form.otpBox span.resend').hide();setTimeout(function(){$('form.otpBox span.resend').show();},(2*60*1000));}else{var ischangenumber=$(".popupForm .formBox").hasClass("changenumber");if(ischangenumber==true){$("#agentNumberChange").find("#dev_errormsg").text(data.message);$("#agentNumberChange").find("#dev_errormsg").css("display","inline");}else{$("#"+formid).find("#dev_errormsg").text(data.message);$("#"+formid).find("#dev_errormsg").css("display","inline");}}
$('#loaderBox').hide();}});}
const time_remaining=(endtime)=>{let t=Date.parse(endtime)-Date.now();let seconds=Math.floor((t/1000)%60);let minutes=Math.floor((t/1000/60)%60);let hours=Math.floor((t/(1000*60*60))%24);let days=Math.floor(t/(1000*60*60*24));return{'total':t,'days':days,'hours':hours,'minutes':minutes,'seconds':seconds};}
const run_clock=(id,endtime,show,expireText="")=>{if(timeinterval){clearInterval(timeinterval);}
endtime=new Date(Date.now()+endtime*60*1000);let clock=$('#'+id);const update_clock=()=>{let t=time_remaining(endtime);clock.html(t.minutes.toString().padStart(2,0)+':'+t.seconds.toString().padStart(2,0));if(t.total<=0){if(show){clock.html(expireText);}else{clock.hide();}
clearInterval(timeinterval);}}
update_clock();timeinterval=setInterval(update_clock,1000);}
$(document).on("submit","#agentNumberChange",function(e){e.preventDefault();var formid=$("#formid").attr("value");var newcountrycode=$("#agentNumberChange").find("input[name='countryCode']").val();var newmobileno=$("#agentNumberChange").find("input[name='mobile']").val();$("#"+formid).find("input[name='countryCode']").val(newcountrycode);$("#"+formid).find("input[name='mobile']").val(newmobileno);sendOtp(formid);});$(document).on("click","#confirmOtp",function(){var formid=$("#formid").attr("value");var prefix="";if(formid=="ListingChatForm"){prefix="chat";}
let data=$('form.ldBx.ldOtpBx').serializeArray();let otp=""
data.filter(v=>{otp=v.value;});if(otp.length=4){let mobile=$('#otpMobile').html().split('-').pop();let propertyId=$('#'+prefix+'formPropertyId').val();let user=$('#'+prefix+'formUserId').val();let userType=$('#'+prefix+'formUserTypeId').val();let propertyLink=$('#'+prefix+'formPropertyLink').val();confirmOtp(mobile,otp,propertyId,user,userType,formid,propertyLink);}else{}});$(document).on("click",".tlBxCta",function(){let id=$(this).closest('.tlBx').data('id');let user=$(this).closest('.tlBx').data('user');let userType=$(this).closest('.tlBx').data('userType');let propertyTitle=$(this).closest('.tlBx').data('propertyTitle');let propertyLink=$(this).closest('.tlBx').data('propertylink');let location=$(this).closest('.tlBx').data('location');agentContactForm(id,user,userType,propertyTitle,propertyLink,location);});const agentContactForm=(id,user,userType,propertyTitle,propertyLink,location)=>{$('#formPropertyId').val(id);$('#formUserId').val(user);$('#formUserTypeId').val(userType);$('#formPropertyTitle').val(propertyTitle);$("#formPropertyLink").val(propertyLink);$("#formlocation").val(location);$('#listingContactAgentForm button[type=submit]').text('Contact '+(userType=='Owner'?'Owner':'Agent'));if(userType=="Owner"){$('#listingContactAgentForm h5').text('Contact The Property Owner');}else{$('#listingContactAgentForm h5').text('Contact Our Real Estate Experts');}
$('#listingContactAgentForm input.name').focus();}
$('form.ldBx.ldOtpBx span.ldOtpRsndBx button').on('click',function(){var formid=$("#formid").attr("value");sendOtp(formid);$("input[name=otp_contactform").val('');});const firepixel=(data,mobile)=>{if(isfirepixel==true){ta('send','lead');gtag_report_conversion(window.location.href);var leadId=0;if(data.apiResp&&data.apiResp[0]&&parseInt(data.apiResp[0]['leadId'])){leadId=parseInt(data.apiResp[0]['leadId'])}
if(leadId>0){fbq('track','Lead');}
_tfa.push({notify:'event',name:'lead',id:1125593});$("#dev_taboola_lead_noscript").html(taboolanoscript);$.getScript("/assets/lib/js/colombiapixel.js",function(){$("#dev_colombia_lead_noscript").html(colombianoscript);});window.dotq=window.dotq||[];window.dotq.push({'projectId':'10000','properties':{'pixelId':'10066198','qstrings':{'et':'custom','ec':'SQY_YahooG_Sec_Leads','ea':'Yahoo_Lead'}}});}}
const confirmOtp=(mobile,otp,propertyId,user,userType,formid,propertyLink)=>{$('#loaderBox').show();$('.otpError').html('');let data=$('#'+formid).serializeArray();let filteredData={mobile,otp,propertyId,user,userType}
data.filter(v=>{filteredData[v.name]=v.value;});$.ajax({type:"POST",url:'/'+type+'/verify-broker-detail-otp',data:filteredData,withCredentials:true,success:function(data){if(data.status){let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
dataLayer.push({'CPageType':'LISTING'+type.toUpperCase(),});if(timeinterval){clearInterval(timeinterval);}
$('#countDownTimer').html(data.message);if(formid=="ListingChatForm"){hideAgentChatForm();}else{hideAgentContactForm();}
if(typeof data.data!='undefined'&&Object.keys(data.data).length){let eventName={"name":filteredData['name'],"emailId":filteredData['email'],"mobile":data.encr,"city":filteredData['location'],"type":type=='resale'?'Resale':'Rental',"propertyId":propertyId,"agentId":filteredData['user'],"agentName":$('#prop_'+filteredData['propertyId']+' .infoBox strong span ').html(),"pageType":dLayer_pagetype};_paq.push(['trackEvent','product','enquired',JSON.stringify(eventName)]);var agentdata=data.data;var hitext="Hi,";if(agentdata.agentName!=undefined){hitext="Hi "+agentdata.agentName+",";}
var whatsapptext=hitext+"%0A%0AI am interested in your listing%0A- "+propertyLink+" on Square Yards.%0A%0A"+
"I look forward to your assistance in my home search. Please get in touch with me at "+
filteredData['countryCode']+"-"+filteredData['mobile']+" to initiate the process.";var whatsappurl="https://api.whatsapp.com/send?phone="+agentdata.agentMobileNo+"&text="+whatsapptext+"&source=&data=";if(formid=="ListingChatForm"){$(".gblPpup.whtsAp, body").removeClass("active");$('#loaderBox').hide();firepixel(data,mobile);window.location.href=whatsappurl;}else{var dev_Modal_agentModalBox='<div class="gblPpup agent active">'+
'<form class="ldBx">'+
'<div class="ldBxClsBtn"><em class="icon-close"></em></div>'+
'<div class="ldBdy">';if(agentdata.agentImage!=undefined&&agentdata.agentImage!=""){dev_Modal_agentModalBox=dev_Modal_agentModalBox+'<div class="ldBxfigureBox"><picture><img itemprop="image" class="img-responsive" src="'+
agentdata.agentImage+'" alt="'+(typeof agentdata.agentName!='undefined'?agentdata.agentName:'N/A')+'"></picture></div>';}else{dev_Modal_agentModalBox=dev_Modal_agentModalBox+'<div class="ldBxfigureBox"><picture><span class="clr clr13">'+(typeof agentdata.agentName!='undefined'?agentdata.agentName.charAt(0).toUpperCase():'N/A')+'</span></picture></div>';}
dev_Modal_agentModalBox=dev_Modal_agentModalBox+'<strong class="ldBxAgntName">'+(typeof agentdata.agentName!='undefined'?agentdata.agentName:'N/A')+'</strong>'+
'<span class="ldBxAgntPhone">'+agentdata.agentMobileNo+'</span>'+
'<span class="ldBxAgntMail">'+agentdata.agentEmailId+'</span>'+
'<ul class="ldBxAgntLdBxBtnBox">'+
'<li><a class="in-call" href="tel:'+agentdata.agentMobileNo+'"><em class="icon-phone-o"></em>Call Now</a></li>'+
'<li><a class="in-whatsapp" href=" '+whatsappurl+'"><em class="icon-whatsapp"></em>WhatsApp</a></li></ul>'+
'</div>';if(data.redirectUrl){dev_Modal_agentModalBox=dev_Modal_agentModalBox+'<a href="'+data.redirectUrl+
'" class="btn btn-primary ldBtnPrmry">Take to My Personal Profile <em class="icon-angle-right"></em></a>';}
dev_Modal_agentModalBox=dev_Modal_agentModalBox+'</form>'+
'<div class="gblOrflw"></div>'+
'</div>';$("#dev_Modal_agentModalBox").html(dev_Modal_agentModalBox);$(".gblPpup.agent .ldBxClsBtn").off("click");$(".gblPpup.agent .ldBxClsBtn").on("click",function(){$('div.gblPpup.agent').removeClass('active')
$('body').toggleClass('active')})
var leadId=0;if(data.apiResp&&data.apiResp[0]&&parseInt(data.apiResp[0]['leadId'])){leadId=parseInt(data.apiResp[0]['leadId'])}
if(leadId>0){$("#dev_Modal_agentModalBox .leadBtnBox li a").off("click");$('#dev_Modal_agentModalBox .leadBtnBox li a').on('click',function(){var interactionType=0;if($(this).hasClass('in-whatsapp')){interactionType=129;}
if($(this).hasClass('in-call')){interactionType=128;}
if(interactionType>0){$.ajax({url:'/user-activity-fetch',dataType:"json",data:{interactionType:interactionType,leadId:leadId,},type:"POST",success:function(data){}});}});}}}else{let formAppend=[$('<div/>',{class:'ldBxClsBtn'}).append($('<em/>',{class:'icon-close'}).on("click",function(){$('div.gblPpup.agent').removeClass('active')
$('body').toggleClass('active')})),$('<div/>',{class:'ldBdy'}).append($('<strong/>',{class:'ldBxMsg',text:data.message}))];if(data.redirectUrl){formAppend.push($('<a/>',{class:'btn btn-primary ldBtnPrmry',href:data.redirectUrl,text:'Take to My Personal Profile'}).append($('<em/>',{class:'icon-angle-right'})));}
$("#dev_Modal_agentModalBox").append($('<div/>',{class:'gblPpup agent active'}).append($('<form/>',{class:'ldBx'}).append(formAppend),$('<div/>',{class:'gblOrflw'})))}
globalfn.setUserHeaderMenu();$('#popupOtpForm').hide();$('#listingContactAgentForm')[0].reset();$('#popupOtpForm')[0].reset();$("#agentNumberChange")[0].reset();firepixel(data,mobile);}else{$('.otpError').html(data.message);}
$('#loaderBox').hide();}});}
const hideAgentContactForm=()=>{$(".gblPpup").removeClass("active");$('#listingContactAgentForm').hide();$('#formPropertyId').val('');$('#formUserId').val('');$('#formUserTypeId').val('');$("#formPropertyLink").val('');$('#formid').attr("value","");}
const hideAgentChatForm=()=>{$(".gblPpup.whtsAp,.overLayBox,body").removeClass("active");$('#listingContactAgentForm').hide();$('#chatformPropertyId').val('');$('#chatformUserId').val('');$('#chatformUserTypeId').val('');$("#chatformPropertyLink").val('');$('#formid').attr("value","");}
$(".propertyTypeClear").off("click");$(".propertyTypeClear").on("click",function(){$('ul.buildingType li input[type=radio]').prop("checked",false);var checkboxclassnames=$(this).attr("checkboxclassnames").split(",");$.each(checkboxclassnames,function(i,checkbox){$("."+checkbox).prop("checked",false);});applyFilter();});$(".dev_clearfilters").off("click");$(".dev_clearfilters").on("click",function(){var checkboxclassnames=$(this).attr("checkboxclassnames").split(",");$.each(checkboxclassnames,function(i,checkbox){$("."+checkbox).prop("checked",false);});applyFilter();});$(".dev_clearfilters_budget").off("click");$(".dev_clearfilters_budget").on("click",function(){$("#min_price").val('');$("#min_price").attr("minval",0);$("#max_price").val('');$("#max_price").attr("maxval",0);applyFilter();});$(".dev_clearfilters_more_filters").off("click");$(".dev_clearfilters_more_filters").on("click",function(){var checkboxclassnames=$(this).attr("checkboxclassnames").split(",");$.each(checkboxclassnames,function(i,checkbox){$("."+checkbox).prop("checked",false);});$("#min_area").val('');$("#min_area").attr("minval",0);$("#max_area").val('');$("#max_area").attr("maxval",0);applyFilter();});$('.dev_clearAllfilters').on('click',function(){window.location=baseUrl+ltype.toLowerCase()+'/property-for-'+ltype.toLowerCase()+'-in-'+cityName.replace(/\W+/g,'-').toLowerCase();})
const getFilteredPage=(url)=>{if(!url){url=baseUrl+type+'/search';}
if(Object.values(queryParams).length){url=url+"?"+Object.keys(queryParams).map(key=>(queryParams[key])?key+'='+encodeURIComponent(queryParams[key]):'').join('&');}
let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
let event_data=new URL(url).searchParams;let eventName={"keyword":event_data.get('q'),"type":type=='resale'?'Resale':'Rental',"city":event_data.get('cityId'),"redirectUrl":url,'pageType':dLayer_pagetype};_paq.push(['trackSiteSearch',JSON.stringify(eventName)]);eventName={"redirectUrl":url,"type":type=='resale'?'Resale':'Rental',"pageType":dLayer_pagetype};setTimeout(()=>{_paq.push(['trackEvent','filter','apply',JSON.stringify(eventName)]);},100);location.href=url;}
$(document).on("click",".tlBtnWtsAp",function(){let id=$(this).closest('.tlBx').data('id');let user=$(this).closest('.tlBx').data('user');let userType=$(this).closest('.tlBx').data('userType');let propertyTitle=$(this).closest('.tlBx').data('propertyTitle');let propertyLink=$(this).closest('.tlBx').data('propertylink');let location=$(this).closest('.tlBx').data('location');agentChatForm(id,user,userType,propertyTitle,propertyLink,location);});const agentChatForm=(id,user,userType,propertyTitle,propertyLink,location)=>{$('#chatformPropertyId').val(id);$('#chatformUserId').val(user);$('#chatformUserTypeId').val(userType);$('#chatformPropertyTitle').val(propertyTitle);$("#chatformPropertyLink").val(propertyLink);$("#chatformlocation").val(location);$(".gblPpup.whtsAp, body").addClass("active");}
$(document).on("click","ul.dev_sortby li",function(){var sortkey=$(this).attr("sortkey");queryParams['sort_key']=sortkey;budgetQueryFilter.minPrice?queryParams['minPrice']=budgetQueryFilter.minPrice:'';budgetQueryFilter.maxPrice?queryParams['maxPrice']=budgetQueryFilter.maxPrice:'';applyFilter();$('.sortByPopup').removeClass('active');});listingfunction.displaySortKey()},displaySortKey:function(){$("ul.dev_sortby li").each(function(){$(this).removeClass("active");let sortKey=$(this).attr('sortkey');if(queryParams.sort_key){if(sortKey==queryParams.sort_key)$(this).addClass("active");}else{$(this).attr('sortkey')=='relevance'?$(this).addClass("active"):'';}});},getFilteredPage:function(url){if(!url){url=baseUrl+type+'/search';}
if(Object.values(queryParams).length){delete queryParams.page
url=url+"?"+Object.keys(queryParams).map(key=>(queryParams[key])?key+'='+encodeURIComponent(queryParams[key]):'').join('&');}
let dLayer_pagetype='';if(typeof(dataLayer)!="undefined"){for(let i=0;i<dataLayer.length;i++){if(dataLayer[i].PageType){dLayer_pagetype=dataLayer[i].PageType;break;}}}
let eventName={"redirectUrl":url,"type":type=='resale'?'Resale':'Rental',"pageType":dLayer_pagetype};_paq.push(['trackEvent','filter','apply',JSON.stringify(eventName)]);window.history.replaceState(null,"",url);helperJS.initializeLazyLoad();},getFilterRR:function(paramsFilterArr){let filtersArr=filters;if(Object.keys(paramsFilterArr).length>0){if(paramsFilterArr.postedBy){let postedByArr=paramsFilterArr.postedBy.split(',');postedByArr.indexOf("1")>=0?filtersArr['byOwner']=true:delete filtersArr['byOwner'];postedByArr.indexOf("2")>=0?filtersArr['byPremiumPartner']=true:delete filtersArr['byPremiumPartner'];postedByArr.indexOf("3")>=0?filtersArr['byEmployee']=true:delete filtersArr['byEmployee'];}else{delete filtersArr['byOwner']
delete filtersArr['byPremiumPartner']
delete filtersArr['byEmployee']}
if(paramsFilterArr.sort_key){filtersArr['sort_key']=paramsFilterArr.sort_key;}
filtersArr.q=(paramsFilterArr.q)?paramsFilterArr.q:'';filtersArr.minArea=(paramsFilterArr.minArea)?paramsFilterArr.minArea:0;filtersArr.maxArea=(paramsFilterArr.maxArea)?paramsFilterArr.maxArea:0;filtersArr.furnishing=(paramsFilterArr.furnishing)?paramsFilterArr.furnishing:'';filtersArr.minPrice=(paramsFilterArr.minPrice)?paramsFilterArr.minPrice:'';filtersArr.maxPrice=(paramsFilterArr.maxPrice)?paramsFilterArr.maxPrice:'';filtersArr.subLocalityId=(paramsFilterArr.locationId)?paramsFilterArr.locationId:'';filtersArr.bedrooms=(paramsFilterArr.bedrooms)?paramsFilterArr.bedrooms:'';filtersArr.buildingTypeId=(paramsFilterArr.buildingType)?paramsFilterArr.buildingType:0;filtersArr.propertyTypeId=(paramsFilterArr.propertyType)?paramsFilterArr.propertyType:0;filtersArr.page=1;filtersArr.isVerified=(paramsFilterArr.isVerified)?paramsFilterArr.isVerified:'';filtersArr.dotcomprojectid=(paramsFilterArr.dotcomprojectid)?paramsFilterArr.dotcomprojectid:'';filtersArr.image360=(paramsFilterArr.image360)?paramsFilterArr.image360:'';}
return JSON.stringify(filtersArr)},doLocationSorting:function(){var LocationItems=$("ul#dev_zone_checkboxes li");var ischecked=$("ul#dev_zone_checkboxes li > label > input[type='checkbox']:checked").length>0;if(ischecked==true){var formatlis=[];var checkedlis=[];var uncheckedlis=[];$("ul#dev_zone_checkboxes li").each(function(i,liitem){var liitem_checkbox=$(liitem).find("label > input[type='checkbox']:checked").length>0;if(liitem_checkbox==true){checkedlis.push(liitem);}else{uncheckedlis.push(liitem);}});formatlis=checkedlis.concat(uncheckedlis);$("ul#dev_zone_checkboxes").html(formatlis);}},loadMoreAjax:function(objParam){let{params,locNamesArr}=objParam;let filter=this.getFilterRR(params)
let _body={pararmsFilter:filter,type:type,cityName:cityName,ltype:ltype,cityId:cityId,params:JSON.stringify(params),locNamesArr:locNamesArr.join(),page:page};$.ajax({async:true,global:false,url:"/getResaleFilterTile",data:_body,method:"POST",dataType:"html",beforeSend:function(){infiniteScroll=false
$(".tpTbBo").hide();$('.swngBo').hide();$('.lstUpdt').hide();$('.skeletonTile').show();$('.dseprojectdata').hide();$('.squarePlusFilter').hide();},complete:function(){$('.skeletonTile').hide();$('.dseprojectdata').show();},success:function(data){locationName=locNamesArr.join();infiniteScroll=false
$('.listing-parent-div').empty();$('.listing-parent-div').append(data);infiniteScollpageNo=1;infiniteScroll=true;scrollLock=true;listingfunction.doLocationSorting();listingfunction.init();listingfunction.getFilteredPage()}})}}
var $window=$(window),previousScrollTop=0,scrollLock=false;$window.scroll(function(event){if(scrollLock){$window.scrollTop(previousScrollTop);}});$(window).scroll(function(){const ele=$('.tlBx').length>=6?$('.tlBx').eq(-6):$('.tlBx').eq(-$('.tlBx').length);if(ele.length){const et=ele.offset().top;const eh=ele.outerHeight();const wh=$(window).height();const ws=$(this).scrollTop();if(ws>et+eh-wh&&infiniteScroll){infiniteScollpageNo++;filters.page=infiniteScollpageNo;let filterData={filters:JSON.stringify(filters),type:type,cityName:cityName,ltype:ltype,cityId:cityId,locationName:locationName,page:page,params:JSON.stringify(queryParams)};infiniteScroll=false;$('.infinite-loader').show();$.ajax({type:"POST",url:'/getListingsRR',data:filterData,success:function(data){if(data.includes('Sorry, no results found!')){infiniteScroll=false;$('.infinite-loader').hide();}else{infiniteScroll=true;$.getScript("/assets/lib/js/gtm.js",function(){$("#gtmBodyScript").html(gtmBodyScript);});$('.infinite-loader').hide();$('.listing-parent-div').append(data);let currentUrl=window.location.pathname;let searchUrl=window.location.search;if(searchUrl.length)currentUrl=currentUrl+searchUrl;if(queryParams.page){if(currentUrl.includes('&page=')){currentUrl=currentUrl.replace(`&page=${queryParams.page}`,"");}else if(currentUrl.includes('?page=')){currentUrl=currentUrl.replace(`?page=${queryParams.page}`,"");}}
if(currentUrl.includes("?")){currentUrl=currentUrl.split('?')[0]+`?page=${infiniteScollpageNo}`;if(currentUrl.includes('/search')&&Object.values(queryParams).length){currentUrl=currentUrl+"&"+Object.keys(queryParams).map(key=>(queryParams[key]&&queryParams[key]!='undefined')?key+'='+encodeURIComponent(queryParams[key]):'').join('&');}}else{currentUrl=currentUrl+`?page=${infiniteScollpageNo}`;}
window.history.pushState(null,"",currentUrl)
helperJS.initializeLazyLoad();}}});}}
scrollLock=false;});